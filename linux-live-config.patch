--- _broken-linux-live-5.5.0/config	2006-09-21 19:09:14.000000000 +0300
+++ linux-live-5.5.0/config	2006-09-27 01:47:53.000000000 +0300
@@ -13,11 +13,24 @@
 
 # change this variable if you installed your distro to some directory.
 # for example ROOT=/tmp/newdir. You may leave it empty, then it defaults to /
-ROOT=
+ROOT=/vservers/anaconda/root
 
 # kernel version. Change it to "2.6.10" for example, if you are building
 # LiveCD with a different kernel than the one you are actually running
-KERNEL="`uname -r`"
+image=$(cd $ROOT; readlink boot/vmlinuz)
+KERNEL="${image#vmlinuz-}"
+
+initrddir="${ROOT%/root}/linux-live-$LINUX_LIVE_VERSION/initrd/kernel-modules/$KERNEL"
+if [ ! -d $initrddir ]; then
+	echo >&2 "Creating $initrd dir"
+	mkdir -p $initrddir
+	cp -af $ROOT/lib/modules/$KERNEL/kernel/fs/squashfs/squashfs.ko* $initrddir
+	if [ -f $ROOT/lib/modules/$KERNEL/kernel/fs/unionfs.ko* ]; then
+		cp -af $ROOT/lib/modules/$KERNEL/kernel/fs/unionfs.ko* $initrddir
+	else
+		cp -af $ROOT/lib/modules/$KERNEL/kernel/fs/unionfs/unionfs.ko* $initrddir
+	fi
+fi
 
 # list of directories which will be modularized
 # You may add 'dev' inthere in the case your distro doesn't have udev installed
@@ -28,15 +41,15 @@
-CDDATA=/tmp/live_data_$$
+CDDATA=../live_data_$$
 
 # name of initrd image
 INITRDIMG=initrd
 
 # Enable debug by setting the following parameter to "logfile.log"
-DEBUG=/tmp/linux-live-debug.log
+DEBUG=../linux-live-debug.log
 
 # Install/uninstall all scripts from /tools to /usr/sbin and /usr/lib
 # so the user is able to use all these commands while running his/her Live Linux
 # Disable if your distro already contains installed linux live tools.
-INSTALL_TOOLS=1
+INSTALL_TOOLS=0
 
 # where to save resulting livecd ISO image
-ISO_IMAGE=/tmp/livecd.iso
+ISO_IMAGE=${ISO_IMAGE:-/home/glen/livecd.iso}
--- linux-live/runme.sh	2006-10-13 15:11:34.000000000 +0300
+++ linux-live/runme.sh	2006-10-13 15:33:24.000000000 +0300
@@ -10,8 +10,8 @@
 echo "Changing current directory to $CHANGEDIR"
 cd $CHANGEDIR
 
-. ./config || exit 1
-. liblinuxlive || exit 1
+. /etc/linux-live/config || exit 1
+. /usr/lib/liblinuxlive || exit 1
 
 # only root can continue, because only root can read all files from your system
 allow_only_root
@@ -19,9 +19,9 @@
 # search for kernel
 VMLINUZ=$ROOT/boot/vmlinuz
 if [ -L "$VMLINUZ" ]; then VMLINUZ=`readlink -f $VMLINUZ`; fi
-echo -ne "Enter path for the kernel you wanna use [hit enter for $VMLINUZ]: "
-read NEWKERNEL
-if [ "$NEWKERNEL" != "" ]; then VMLINUZ="$NEWKERNEL"; fi
+#echo -ne "Enter path for the kernel you wanna use [hit enter for $VMLINUZ]: "
+#read NEWKERNEL
+#if [ "$NEWKERNEL" != "" ]; then VMLINUZ="$NEWKERNEL"; fi
 if [ "`ls $VMLINUZ 2>>$DEBUG`" = "" ]; then echo "cannot find $VMLINUZ"; exit 1; fi
 
 header "Creating LiveCD from your Linux"
